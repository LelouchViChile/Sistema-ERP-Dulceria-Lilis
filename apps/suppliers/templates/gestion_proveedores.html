{% extends "base.html" %}
{% block title %}Proveedores{% endblock %}

{% block content %}
<h5 class="fw-bold mt-3">Gestión Proveedores</h5>
<div class="card shadow-sm mb-4">
    <div class="card-header pb-1">
        <h6>Formulario de Proveedor</h6>
        <ul class="nav nav-tabs mt-2" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#tab1">Ingrese datos del proveedor</a>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content">
            <div id="tab1" class="tab-pane fade show active">
                <div class="row g-2">
                    <div class="col-md-6">
                        <label class="form-label">RUT/NIF</label>
                        <input type="text" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Razón social</label>
                        <input type="text" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Nombre fantasía (opcional)</label>
                        <input type="text" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Teléfono</label>
                        <input type="text" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Sitio web (opcional)</label>
                        <input type="text" class="form-control">
                    </div>
                </div>
                <div class="mt-3">
                    <button type="button" class="btn btn-primary" onclick="guardarProveedor()">Guardar</button>
                    <button type="button" class="btn btn-light">Limpiar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div>Proveedores</div>
        <button class="btn btn-outline-secondary btn-sm">Exportar a Excel</button>
    </div>
    <div class="card-body">
        <div class="row mb-2">
            <div class="col-sm-4">
                <input type="text" class="form-control" placeholder="Buscar por RUT/NIF o razón social">
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-striped align-middle text-center">
                <thead>
                    <tr>
                        <th>RUT/NIF</th>
                        <th>Razón social</th>
                        <th>Estado</th>
                        <th>Email</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in proveedores %}
                    <tr>
                        <td>{{ p.rut }}</td>
                        <td>{{ p.razon_social }}</td>
                        <td>
                            {% if p.estado == "Activo" %}
                            <span class="badge bg-success">ACTIVO</span>
                            {% elif p.estado == "Bloqueado" or p.estado == "Inactivo" %}
                            <span class="badge bg-danger">{{ p.estado|upper }}</span>
                            {% endif %}
                        </td>
                        <td>{{ p.email }}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editarProveedor('{{ p.rut }}')">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="eliminarProveedor('{{ p.rut }}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>

    function guardarProveedor() {
        Swal.fire({
            title: 'Guardar datos',
            text: '¿Deseas guardar los datos del proveedor?',
            icon: 'info',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#c11b17',
            confirmButtonText: 'Sí, guardar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire('Proveedor guardado', 'Los datos fueron almacenados correctamente', 'success');
            }
        });
    }

    function editarProveedor(rut) {
        Swal.fire({
            title: '¿Estás seguro?',
            text: 'Vas a editar el proveedor ' + rut,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#c11b17',
            confirmButtonText: 'Sí, editar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire('Redirigiendo...', '', 'info');
            }
        });
    }

    function eliminarProveedor(rut) {
        Swal.fire({
            title: 'Advertencia',
            text: '¿Quieres eliminar el proveedor ' + rut + '? Esta acción es irreversible.',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#c11b17',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Sí, eliminar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire('Eliminado', 'Proveedor ' + rut + ' eliminado (simulado)', 'success');
            }
        });
    }
</script>
{% endblock %}